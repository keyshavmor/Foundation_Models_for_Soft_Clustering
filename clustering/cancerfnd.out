--- Loading Configuration ---
Loaded configuration for: CancerFoundation_NB_Dataset3_Analysis
--- Setting up Paths and Scanpy ---
Scanpy figure directory set to: results/scanpy_plots
--- Matplotlib plt.show() patched to save figures instead. ---
--- Loading/Generating CancerFoundation Embeddings ---
Embedding file not found or regeneration forced: resources/embeddings/NBatlas_cnv_endothelial_ref_percluster2000hvg.h5ad
Loading source AnnData and performing embedding...
Loaded source AnnData from ../data/NBatlas_cnv_endothelial_ref_percluster2000hvg.h5ad
AnnData object with n_obs × n_vars = 119439 × 2000
    obs: 'orig.ident', 'nCount_RNA', 'nFeature_RNA', 'percent_mito', 'Study', 'Assay', 'Platform', 'Sample', 'Patient_No', 'Timepoint', 'INSS_stage', 'MYCN_amplification', 'Gender', 'Risk', 'Cell_condition', 'Cell_type', 'cell', 'n_genes', 'leiden', 'cnv_leiden', 'cnv_score', 'cnv_status'
    var: 'hgnc_symbol', 'ensembl_gene_id', 'gene_biotype', 'n_cells', 'mean', 'std', 'chromosome', 'start', 'end', 'gene_id', 'gene_name', 'highly_variable', 'highly_variable_rank', 'means', 'variances', 'variances_norm'
    uns: 'Cell_type_colors', 'INSS_stage_colors', 'Sample_colors', 'Study_colors', 'cnv', 'cnv_leiden', 'cnv_leiden_colors', 'cnv_neighbors', 'dendrogram_cnv_leiden', 'hvg', 'leiden', 'neighbors', 'pca', 'umap'
    obsm: 'X_cnv', 'X_cnv_pca', 'X_cnv_umap', 'X_pca', 'X_pca_harmony', 'X_umap', 'scvi_umap'
    varm: 'PCs'
    layers: 'RNA', 'log1p_norm'
    obsp: 'cnv_neighbors_connectivities', 'cnv_neighbors_distances', 'connectivities', 'distances'
Batch key is Sample
input_layer is RNA
adata_source.X has shape (6781, 1476) and values:   (0, 74)	1.0
  (0, 114)	1.0
  (0, 153)	1.0
  (0, 229)	1.0
  (0, 248)	1.0
  (0, 429)	1.0
  (0, 508)	1.0
  (0, 552)	1.0
  (0, 648)	2.0
  (0, 852)	1.0
  (0, 853)	1.0
  (0, 875)	2.0
  (0, 996)	22.0
  (1, 48)	1.0
  (1, 74)	6.0
  (1, 99)	1.0
  (1, 108)	5.0
  (1, 110)	3.0
  (1, 114)	3.0
  (1, 116)	1.0
  (1, 127)	4.0
  (1, 139)	1.0
  (1, 165)	1.0
  (1, 166)	1.0
  (1, 168)	1.0
  :	:
  (6780, 421)	2.0
  (6780, 475)	2.0
  (6780, 489)	3.0
  (6780, 500)	1.0
  (6780, 508)	1.0
  (6780, 511)	1.0
  (6780, 517)	1.0
  (6780, 520)	2.0
  (6780, 521)	2.0
  (6780, 537)	3.0
  (6780, 552)	1.0
  (6780, 643)	1.0
  (6780, 647)	1.0
  (6780, 685)	1.0
  (6780, 687)	1.0
  (6780, 757)	2.0
  (6780, 776)	1.0
  (6780, 812)	3.0
  (6780, 816)	8.0
  (6780, 852)	1.0
  (6780, 891)	4.0
  (6780, 920)	5.0
  (6780, 945)	18.0
  (6780, 955)	2.0
  (6780, 996)	151.0
Calling embedding function...
WARNING: CUDA is not available. Using CPU instead.
